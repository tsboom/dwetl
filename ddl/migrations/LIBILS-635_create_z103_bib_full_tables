--
-- Summary of LIBILS-635 db changes: 
-- added PK to dw_stg_2_lbry_item_fact_z30_full
-- dropped incorrectly named dw_stg_1_mai50_z103_bib. We are using dw_stg_1_mai50_z103_bib_full
-- dropped and created dw_stg_2_lbry_item_fact_z103_bib_full with correct column names and PK


--
-- Name: dw_stg_2_lbry_item_fact_z30_full pk_dw_stg_2_lbry_item_fact_z30_full; Type: CONSTRAINT; Schema: public; Owner: usmai_dw
--

ALTER TABLE ONLY public.dw_stg_2_lbry_item_fact_z30_full
    ADD CONSTRAINT pk_dw_stg_2_lbry_item_fact_z30_full PRIMARY KEY (db_operation_cd, rec_trigger_key, em_create_dw_prcsng_cycle_id);



--
-- Remove table --
-- Name: dw_stg_1_mai50_z103_bib ?
--
DROP TABLE dw_stg_1_mai50_z103_bib;

--
-- Remove unnecessary stage 2 tables --
-- Name: dw_stg_2_lbry_item_z103_bib
--
DROP TABLE dw_stg_2_lbry_item_z103_bib;

--
-- Drop and Create table dw_stg_2_lbry_item_fact_z103_bib_full with right columns
-- Name: dw_stg_2_lbry_item_fact_z103_bib_full; Type: TABLE; Schema: public; Owner: usmai_dw
--
DROP TABLE dw_stg_2_lbry_item_fact_z103_bib_full;
CREATE TABLE public.dw_stg_2_lbry_item_fact_z103_bib_full (
    rec_type_cd character(1) NOT NULL,
    db_operation_cd character(1) NOT NULL,
    rec_trigger_key character(15) NOT NULL,
    in_source character(9),
    in_dest character(9),
    in_dest_lib character(5),
    in_dest_docnum character(9),
    rm_suspend_rec_flag character(1) DEFAULT 'N'::bpchar NOT NULL,
    rm_suspend_rec_reason_cd character(3),
    rm_dq_check_excptn_cnt smallint DEFAULT 0 NOT NULL,
    em_create_dw_prcsng_cycle_id integer NOT NULL,
    em_create_dw_job_exectn_id integer NOT NULL,
    em_create_dw_job_name character varying(100) NOT NULL,
    em_create_dw_job_version_no character varying(20) NOT NULL,
    em_create_user_id character varying(20) NOT NULL,
    em_create_tmstmp timestamp without time zone NOT NULL,
    em_update_dw_prcsng_cycle_id integer,
    em_update_dw_job_exectn_id integer,
    em_update_dw_job_name character varying(100),
    em_update_dw_job_version_no character varying(20),
    em_update_user_id character varying(20),
    em_update_tmstmp timestamp without time zone
)
WITH (autovacuum_enabled='true');


ALTER TABLE public.dw_stg_2_lbry_item_fact_z103_bib_full OWNER TO usmai_dw;

-- create PK
-- Name: dw_stg_2_lbry_item_fact_z103_bib_full pk_dw_stg_2_lbry_item_fact_z103_bib_full; Type: CONSTRAINT; Schema: public; Owner: usmai_dw
--

ALTER TABLE ONLY public.dw_stg_2_lbry_item_fact_z103_bib_full
    ADD CONSTRAINT pk_dw_stg_2_lbry_item_fact_z103_bib_full PRIMARY KEY (db_operation_cd, rec_trigger_key, em_create_dw_prcsng_cycle_id);





